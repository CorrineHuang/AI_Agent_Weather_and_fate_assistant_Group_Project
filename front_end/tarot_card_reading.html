<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tarot Card Reading</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f7f7f7;
            text-align: center;
        }

        .card-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-evenly;
            padding: 20px;
        }

        .card {
            width: 120px;
            height: 180px;
            background-color: #333;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 10px;
            cursor: pointer;
            position: relative;
            perspective: 1000px;
        }

        .card-inner {
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 1s ease;
            position: absolute;
        }

        .card-front, .card-back {
            backface-visibility: hidden;
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 16px;
        }

        .card-back {
            transform: rotateY(180deg);
            background-color: #ffcc00;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-name {
            font-size: 18px;
            font-weight: bold;
            transition: transform 0.5s;
        }

        /* Mirror text for the first flip */
        .card-name.mirrored {
            transform: scaleX(-1);
        }

        /* 对话框容器 */
        .card-info {
            position: fixed; /* Use fixed positioning to center on the screen */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.2); /* Initial scale and center */
            background-color: #fff;
            color: black;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            width: 80%;
            max-width: 400px;
            opacity: 0; /* Initially hidden */
            visibility: hidden; /* Hide the element initially */
            transition: transform 0.5s ease, opacity 0.5s ease, visibility 0.5s ease; /* Smooth transition */
        }

        /* 放大效果 */
        .card-info.show {
            opacity: 1; /* Fade in */
            visibility: visible; /* Make the element visible */
            transform: translate(-50%, -50%) scale(2); /* Scale to normal size */
        }

        /* 显示卡片名称和描述的样式 */
        .card-info h2 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .card-info p {
            font-size: 16px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>

<h1>Tarot Card Reading</h1>
<div class="container">
    <div class="card-container">
        <!-- Loop through tarot cards and render each one -->
        {% for card, description in tarot_cards.items() %}
        <div class="card" onclick="drawCard('{{ card }}', '{{ description }}', this)">
            <div class="card-inner">
                <div class="card-front">
                    <!-- Initially show 'Click to Draw' -->
                    Click to Draw
                </div>
                <div class="card-back">
                    <div class="card-name">{{ card }}</div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Popup dialog to show card details -->
<div class="card-info" id="card-info">
    <h2 id="card-name"></h2>
    <p id="card-description"></p>
    <p id="card-analysis"></p>
</div>

<script>
    // Pass the tarot cards to the front-end
    const tarotCards = {{ tarot_cards | tojson }};
    
    function drawCard(cardName, cardDescription, cardElement) {
        const cardNameElement = cardElement.querySelector('.card-name');
        const frontElement = cardElement.querySelector('.card-front');
        
        // Initially, set the card front text as "Click to Draw"
        frontElement.textContent = "Click to Draw";
        
        // Add the mirrored effect on the card name (first flip)
        cardNameElement.classList.add('mirrored');

        // Flip the card (rotateY 180deg)
        cardElement.classList.add('flipped');

        // After the first flip, show the mirrored card name
        setTimeout(() => {
            // Set the mirrored card name
            cardNameElement.textContent = cardName;
        }, 500); // Wait for the card to flip

        // After another timeout (end of the animation), flip back and show the normal name
        setTimeout(() => {
            // Flip back and show the normal name (card name on the front)
            cardElement.classList.remove('flipped');
            cardNameElement.classList.remove('mirrored');
            cardNameElement.textContent = cardName; // Set back to normal name

            // Remove the "Click to Draw" text and show the card name permanently
            frontElement.textContent = cardName;

            // Show the popup dialog with card name, description, and analysis
            showCardInfo(cardName, cardDescription);
        }, 1500); // Wait for 1 second before flipping back
    }

    function showCardInfo(cardName, cardDescription) {
        // Show the card info in the popup dialog
        const cardInfo = document.getElementById('card-info');
        const cardNameElement = document.getElementById('card-name');
        const cardDescriptionElement = document.getElementById('card-description');
        const cardAnalysisElement = document.getElementById('card-analysis');

        cardNameElement.textContent = cardName;
        cardDescriptionElement.textContent = cardDescription;
        cardAnalysisElement.textContent = `This is a general analysis of the ${cardName} card.`; // A simple placeholder analysis

        // Apply animation to make the dialog appear with a scaling effect
        cardInfo.classList.add('show');
    }
</script>

</body>
</html>